(function(){var h={"extends":function(a,b){b.prototype=new a},stackCounterLimit:1E3,stackCounter:0};h.recur=function(a){h.stackCounter===h.stackCounterLimit?(h.stackCounter=0,setTimeout(a,0)):(h.stackCounter++,a())};h.shuffle=function(a){for(var b,d,j=a.length;j;b=parseInt(Math.random()*j),d=a[--j],a[j]=a[b],a[b]=d);return a};h.include=function(a,b,d){for(var j=a.length-1;j>=0;j--){var k=!1,k=d==null?a[j]===b:d(a[j],b)===0;if(k===!0)return!0}return!1};h.remove=function(a,b){for(var d=[],j=0;j<a.length;j++)a[j]!==
b&&d.push(a[j]);return d};h.repeat=function(a,b,d,j,k){arguments.length===4&&(k={});a<b?(k._i=a,d(function(d,e){h.recur(function(){h.repeat(a+1,b,d,j,e)})},k)):j(k)};Utilsmeanwhile=function(a,b,d,j){arguments.length===3&&(j={});j._stack_counter==null&&(j._stack_counter=0);a===!0?b(function(a,b,c){c._stack_counter%40==39?(c._stack_counter+=1,setTimeout(function(){Utilsmeanwhile(a,b,d,c)},0)):(c._stack_counter+=1,Utilsmeanwhile(a,b,d,c))},j):d(j)};h.seq=function(){var a=arguments;return function(b){h.repeat(0,
a.length,function(b,c){var k=arguments.callee;a[c._i](function(){b(k,c)})},function(){b()})}};h.partition=function(a,b){for(var d=a.length%b,j=[],k=0;k<d;k++)j.push(null);d=[];for(k=0;k<a.length;k++)j.push(a[k]),j.length%b==0&&(d.push(j),j=[]);return d};h.keys=function(a){var b=[],d;for(d in a)b.push(d);return b};h.iso8601=function(a){function b(a){return a<10?"0"+a:a}return a.getUTCFullYear()+"-"+b(a.getUTCMonth()+1)+"-"+b(a.getUTCDate())+"T"+b(a.getUTCHours())+":"+b(a.getUTCMinutes())+":"+b(a.getUTCSeconds())+
"Z"};h.parseStrictISO8601=function(a){var a=a.match(RegExp("([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?")),b=0,d=new Date(a[1],0,1);if(a[3])d.setMonth(a[3]-1);else throw"missing ISO8061 component";if(a[5])d.setDate(a[5]);else throw"missing ISO8061 component";if(a[7])d.setHours(a[7]);else throw"missing ISO8061 component";if(a[8])d.setMinutes(a[8]);else throw"missing ISO8061 component";if(a[10])d.setSeconds(a[10]);else throw"missing ISO8061 component";
a[12]&&d.setMilliseconds(Number("0."+a[12])*1E3);a[14]&&(b=Number(a[16])*60+Number(a[17]),b*=a[15]=="-"?1:-1);b-=d.getTimezoneOffset();time=Number(d)+b*6E4;a=new Date;a.setTime(Number(time));return a};h.parseISO8601=function(a){var a=a.match(RegExp("([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?")),b=0,d=new Date(a[1],0,1);a[3]&&d.setMonth(a[3]-1);a[5]&&d.setDate(a[5]);a[7]&&d.setHours(a[7]);a[8]&&d.setMinutes(a[8]);a[10]&&
d.setSeconds(a[10]);a[12]&&d.setMilliseconds(Number("0."+a[12])*1E3);a[14]&&(b=Number(a[16])*60+Number(a[17]),b*=a[15]=="-"?1:-1);b-=d.getTimezoneOffset();time=Number(d)+b*6E4;a=new Date;a.setTime(Number(time));return a};h.parseISO8601Components=function(a){var a=a.match(RegExp("([0-9]{4})(-([0-9]{2}))(-([0-9]{2}))(T([0-9]{2}):([0-9]{2})(:([0-9]{2}))?(.([0-9]+))?)?(Z|([-+])([0-9]{2})(:([0-9]{2}))?)?")),b,d,j,k,g,e,f,h;b=Number(a[1]);d=a[3]-1;j=Number(a[5]);k=Number(a[7]);g=Number(a[8]);e=Number(a[10]);
a[12]&&(f=Number("0."+a[12])*1E3);a[13]==="Z"?h=0:a[14]?(h=0,a[17]&&(h=Number(a[17])),h+=Number(a[15])*60,h*=a[14]=="-"?-1:1):a[14]==null&&a[11]&&(h=Number(a[12])*60);return{year:isNaN(b)?null:b,month:isNaN(d)?null:d,date:isNaN(j)?null:j,hours:isNaN(k)?null:k,minutes:isNaN(g)?null:g,seconds:isNaN(e)?null:e,millisecs:isNaN(f)?null:f,timezone:isNaN(h)?null:h}};h.compareDateComponents=function(a,b){var d=h.parseISO8601Components(a),j=h.parseISO8601Components(b);return d.timezone==null&&j.timezone==null||
d.timezone!=null&&j.timezone!=null?(da=h.parseISO8601(a),db=h.parseISO8601(b),da.getTime()==db.getTime()?0:da.getTime()<db.getTime()?-1:1):d.timezone!=null&&j.timezone==null?(da=h.parseISO8601(a),db=h.parseISO8601(b),ta=da.getTime(),tb=db.getTime(),d=50400,ta<tb&&ta<tb+d?-1:ta>tb&&ta>tb-d?1:null):(da=h.parseISO8601(a),db=h.parseISO8601(b),ta=da.getTime(),tb=db.getTime(),d=50400,ta<tb&&ta+d<tb?-1:ta>tb&&ta+d>tb?1:null)};h.lexicalFormLiteral=function(a,b){var d=a.value,j=a.lang,k=a.type,g=null;d!=null&&
k!=null&&typeof k!="string"?(d=k.value,d!=null?g='"'+a.value+'"^^<'+d+">":(d=k.suffix,k=b.namespaces[k.prefix],a.type=k+d,g='"'+a.value+'"^^<'+k+d+">")):g=j==null&&k==null?'"'+d+'"':k==null?'"'+d+'"@'+j:'"'+a.value+'"^^<'+k+">";return g};h.lexicalFormBaseUri=function(a,b){var d=null;if(a.value==null)var d=a.prefix,j=a.suffix,k=b.namespaces[d],d=k!=null?k+j:d+":"+j;else d=a.value;if(d===null)return null;else d.indexOf(":")==-1&&(d=(b.base||"")+d);return d};h.lexicalFormTerm=function(a,b){if(a.token===
"uri")return{uri:h.lexicalFormBaseUri(a,b)};else if(a.token==="literal")return{literal:h.lexicalFormLiteral(a,b)};else if(a.token==="blank")return{blank:"_:"+a.label};else callback(!1,"Token of kind "+a.token+" cannot transformed into its lexical form")};h.normalizeUnicodeLiterals=function(a){for(var b=a.match(/\\u[0-9abcdefABCDEF]{4,4}/g)||[],d={},j=0;j<b.length;j++)d[b[j]]==null&&(d[b[j]]=!0,a=a.replace(RegExp("\\"+b[j],"g"),eval("'"+b[j]+"'")));return a};h.hashTerm=function(a){try{if(a==null)return"";
if(a.token==="uri")return"u"+a.value;else if(a.token==="blank")return"b"+a.value;else if(a.token==="literal")return l="l"+a.value,l+=a.type||"",l+=a.lang||"",l}catch(b){if(typeof a==="object"){var d="";for(p in a)d=d+p+a[p];return d}return a}};var f={defaultContext:{rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",owl:"http://www.w3.org/2002/07/owl#",xsd:"http://www.w3.org/2001/XMLSchema#",dcterms:"http://purl.org/dc/terms/",foaf:"http://xmlns.com/foaf/0.1/",
cal:"http://www.w3.org/2002/12/cal/ical#",vcard:"http://www.w3.org/2006/vcard/ns# ",geo:"http://www.w3.org/2003/01/geo/wgs84_pos#",cc:"http://creativecommons.org/ns#",sioc:"http://rdfs.org/sioc/ns#",doap:"http://usefulinc.com/ns/doap#",com:"http://purl.org/commerce#",ps:"http://purl.org/payswarm#",gr:"http://purl.org/goodrelations/v1#",sig:"http://purl.org/signature#",ccard:"http://purl.org/commerce/creditcard#"},UrisMap:function(){this.defaultNs="";this.interfaceProperties=["get","remove","set",
"setDefault","addAll","resolve","shrink"]}};f.UrisMap.prototype.values=function(){var a={},b;for(b in this)!h.include(this.interfaceProperties,b)&&typeof this[b]!=="function"&&b!=="defaultNs"&&b!=="interfaceProperties"&&(a[b]=this[b]);return a};f.UrisMap.prototype.get=function(a){if(a.indexOf(" ")!=-1)throw"Prefix must not contain any whitespaces";return this[a]};f.UrisMap.prototype.remove=function(a){if(a.indexOf(" ")!=-1)throw"Prefix must not contain any whitespaces";delete this[a];return null};
f.UrisMap.prototype.set=function(a,b){if(a.indexOf(" ")!=-1)throw"Prefix must not contain any whitespaces";this[a]=b};f.UrisMap.prototype.setDefault=function(a){this.defaultNs=a};f.UrisMap.prototype.addAll=function(a,b){for(var d in a)h.include(this.interfaceProperties,d)||(this[d]!=null?b===!0&&(this[d]=a[d]):this[d]=a[d]);return this};f.UrisMap.prototype.resolve=function(a){var b=a.split(":"),a=b[0],b=b[1];return a===""?this.defaultNs==null?null:this.defaultNs+b:this[a]!=null?this[a]+b:null};f.UrisMap.prototype.shrink=
function(a){for(var b in this){var d=this[b];if(a.indexOf(d)===0&&d!==""&&b!="defaultNs")return a=a.split(d)[1],b+":"+a}return a};f.Profile=function(){this.prefixes=new f.UrisMap;this.terms=new f.UrisMap};f.Profile.prototype.importProfile=function(a,b){this.prefixes.addAll(a.prefixes,b);this.terms.addAll(a.terms,b)};f.Profile.prototype.resolve=function(a){return a.indexOf(":")!=-1?this.prefixes.resolve(a):this.terms[a]!=null?this.terms.resolve(a):null};f.Profile.prototype.setDefaultPrefix=function(a){this.prefixes.setDefault(a)};
f.Profile.prototype.setDefaultVocabulary=function(a){this.terms.setDefault(a)};f.Profile.prototype.setPrefix=function(a,b){this.prefixes.set(a,b)};f.Profile.prototype.setTerm=function(a,b){this.terms.set(a,b)};f.RDFEnvironment=function(){this.blankNodeCounter=0;var a=this;this.filters={s:function(a){return function(b){return b.subject.equals(a)}},p:function(a){return function(b){return b.predicate.equals(a)}},o:function(a){return function(b){return b.object.equals(a)}},sp:function(a,b){return function(c){return c.subject.equals(a)&&
c.predicate.equals(b)}},so:function(a,b){return function(c){return c.subject.equals(a)&&c.object.equals(b)}},po:function(a,b){return function(c){return c.predicate.equals(a)&&c.object.equals(b)}},spo:function(a,b,c){return function(g){return g.subject.equals(a)&&g.predicate.equals(b)&&g.object.equals(c)}},describes:function(a){return function(b){return b.subject.equals(a)||b.object.equals(a)}},type:function(b){var c=a.resolve("rdf:type");return function(a){return a.predicate.equals(c)&&a.object.equals(b)}}};
for(var b in f.defaultContext)this.prefixes.set(b,f.defaultContext[b])};h["extends"](f.Profile,f.RDFEnvironment);f.RDFEnvironment.prototype.createBlankNode=function(){var a=new f.BlankNode(this.blankNodeCounter);this.blankNodeCounter++;return a};f.RDFEnvironment.prototype.createNamedNode=function(a){var b=this.resolve(a);return b!=null?new f.NamedNode(b):new f.NamedNode(a)};f.RDFEnvironment.prototype.createLiteral=function(a,b,d){return d!=null?new f.Literal(a,b,d.toString()):new f.Literal(a,b,d)};
f.RDFEnvironment.prototype.createTriple=function(a,b,d){return new f.Triple(a,b,d)};f.RDFEnvironment.prototype.createGraph=function(a){var b=new f.Graph;if(a!=null)for(var d=0;d<a.length;d++)b.add(a[d]);return b};f.RDFEnvironment.prototype.createAction=function(a,b){return function(d){return a(d)?b(d):d}};f.RDFEnvironment.prototype.createProfile=function(a){return a===!0?new f.RDFEnvironment.Profile:(a=new f.RDFEnvironment.Profile,a.importProfile(this),a)};f.RDFEnvironment.prototype.createTermMap=
function(a){if(a===!0)return new f.UrisMap;else{var a=this.terms.values(),b=new f.UrisMap,d;for(d in a)b[d]=a[d];return b}};f.RDFEnvironment.prototype.createPrefixMap=function(a){if(a===!0)return new f.UrisMap;else{var a=this.prefixes.values(),b=new f.UrisMap,d;for(d in a)b[d]=a[d];return b}};f.RDFNode=function(a){this.interfaceName=a;this.attributes=["interfaceName","nominalValue"]};f.RDFNode.prototype.equals=function(a){if(a.interfaceName==null)return this.valueOf()==a;else{for(var b in this.attributes){var d=
this.attributes[b];if(this[d]!=a[d])return!1}return!0}};f.BlankNode=function(a){f.RDFNode.call(this,"BlankNode");this.nominalValue="_:"+a;this.bnodeId=a};h["extends"](f.RDFNode,f.BlankNode);f.BlankNode.prototype.toString=function(){return this.nominalValue};f.BlankNode.prototype.toNT=function(){return this.nominalValue};f.BlankNode.prototype.valueOf=function(){return this.nominalValue};f.Literal=function(a,b,d){f.RDFNode.call(this,"Literal");this.nominalValue=a;if(b!=null)this.language=b;else if(d!=
null)this.datatype=d};h["extends"](f.RDFNode,f.Literal);f.Literal.prototype.toString=function(){var a='"'+this.nominalValue+'"';if(this.language!=null)a=a+"@"+this.language;else if(this.datatype!=null||this.type)a=a+"^^<"+(this.datatype||this.type)+">";return a};f.Literal.prototype.toNT=function(){return this.toString()};f.Literal.prototype.valueOf=function(){return b.effectiveTypeValue({token:"literal",type:this.type,value:this.nominalValue,language:this.language})};f.NamedNode=function(a){f.RDFNode.call(this,
"NamedNode");this.nominalValue=a.value!=null?a.value:a};h["extends"](f.RDFNode,f.NamedNode);f.NamedNode.prototype.toString=function(){return this.nominalValue};f.NamedNode.prototype.toNT=function(){return"<"+this.toString()+">"};f.NamedNode.prototype.valueOf=function(){return this.nominalValue};f.Triple=function(a,b,d){this.subject=a;this.predicate=b;this.object=d};f.Triple.prototype.equals=function(a){return this.subject.equals(a.subject)&&this.predicate.equals(a.predicate)&&this.object.equals(a.object)};
f.Triple.prototype.toString=function(){return this.subject.toNT()+" "+this.predicate.toNT()+" "+this.object.toNT()+" . \r\n"};f.Graph=function(){this.triples=[];this.duplicates={};this.actions=[]};f.Graph.prototype.add=function(a){for(var b=0;b<this.actions.length;b++)a=this.actions[b](a);b=a.subject.toString()+a.predicate.toString()+a.object.toString();this.duplicates[b]||(this.duplicates[b]=!0,this.triples.push(a));return this};f.Graph.prototype.addAction=function(a,b){this.actions.push(a);if(b==
!0)for(var d=0;d<this.triples.length;d++)this.triples[d]=a(this.triples[d]);return this};f.Graph.prototype.addAll=function(a){for(var a=a.toArray(),b=0;b<a.length;b++)this.add(a[b]);return this};f.Graph.prototype.remove=function(a){for(var b=null,d=0;d<this.triples.length;d++)if(this.triples[d].equals(a)){delete this.duplicates[a.subject.toString()+a.predicate.toString()+a.object.toString()];b=d;break}b!=null&&this.triples.splice(b,1);return this};f.Graph.prototype.toArray=function(){return this.triples};
f.Graph.prototype.some=function(a){for(var b=0;b<this.triples.length;b++)if(a(this.triples[b],this)===!0)return!0;return!1};f.Graph.prototype.every=function(a){for(var b=0;b<this.triples.length;b++)if(a(this.triples[b],this)===!1)return!1;return!0};f.Graph.prototype.filter=function(a){for(var b=new f.Graph,d=0;d<this.triples.length;d++)a(this.triples[d],this)===!0&&b.add(this.triples[d]);return b};f.Graph.prototype.forEach=function(a){for(var b=0;b<this.triples.length;b++)a(this.triples[b],this)};
f.Graph.prototype.merge=function(){for(var a=new f.Graph,b=0;b<this.triples;b++){var d=this.triples[b];a.add(d)}for(b=0;b<triples.length;b++)d=triples[b],this.add(d);return a};f.Graph.prototype.match=function(a,b,d,j){for(var k=new f.Graph,g=0,e=0;e<this.triples.length;e++){var i=this.triples[e];if(a==null||i.subject.equals(a))if(b==null||i.predicate.equals(b))if(d==null||i.object.equals(d))if(j==null||g<j)g++,k.add(i);else break}return k};f.Graph.prototype.removeMatches=function(a,b,d){for(var j=
[],f=0;f<this.triples.length;f++){var g=this.triples[f];if(a==null||g.subject.equals(a))if(b==null||g.predicate.equals(b))(d==null||g.object.equals(d))&&j.push(g)}for(f=0;f<j.length;f++)this.remove(j[f]);return this};f.Graph.prototype.toNT=function(){var a="";this.forEach(function(b){a+=b.toString()});return a};f.buildRDFResource=function(a,b,d,j){return a.token==="blank"?f.buildBlankNode(a,b,d,j):a.token==="literal"?f.buildLiteral(a,b,d,j):a.token==="uri"?f.buildNamedNode(a,b,d,j):a.token==="var"?
(a=b[a.value],a!=null?f.buildRDFResource(a,b,d,j):null):null};f.buildBlankNode=function(a){if(a.value==null&&a.label)a.value=a.label;if(a.value.indexOf("_:")===0)a.value=a.value.split("_:")[1];return new f.BlankNode(a.value)};f.buildLiteral=function(a){return new f.Literal(a.value,a.lang,a.type)};f.buildNamedNode=function(a,b,d,j){if(a.value==null&&a.prefix!=null)b=d.resolveNsInEnvironment(a.prefix,j),a.value=b+a.suffix;return new f.NamedNode(a)};f.rdf=new f.RDFEnvironment;var b={checkFilters:function(a,
c,d,j,f,g){var e=a.filter,i=[];if(e==null||a.length!=null)return c;for(a=0;a<e.length;a++){for(var c=b.run(e[a].value,c,d,j,f,g),h=[],m=0;m<c.length;m++)c[m].__nullify__!=null?i.push(c[m]):h.push(c[m]);c=h}return c.concat(i)}};b.boundVars=function(a){if(a.expressionType!=null){var c=a.expressionType;if(c=="relationalexpression")return c=a.op2,b.boundVars(a.op1)+b.boundVars(c);else if(c=="conditionalor"||c=="conditionaland"){for(var d=[],c=0;c<a.operands;c++)d=d.concat(b.boundVars(a.operands[c]));
return d}else if(c=="builtincall")if(a.args==null)return[];else{d=[];for(c=0;c<a.args.length;c++)d=d.concat(b.boundVars(a.args[c]));return d}else if(c=="multiplicativeexpression"){d=b.boundVars(a.factor);for(c=0;c<a.factors.length;c++)d=d.concat(b.boundVars(a.factors[c].expression));return d}else if(c=="additiveexpression"){d=b.boundVars(a.summand);for(c=0;c<a.summands.length;c++)d=d.concat(b.boundVars(a.summands[c].expression));return d}else if(c=="regex")return d=b.boundVars(a.expression1),d.concat(b.boundVars(a.expression2));
else if(c=="unaryexpression")return b.boundVars(a.expression);else if(c=="atomic")return a.primaryexpression=="var"?[a.value]:[]}else throw console.log("ERROR"),console.log(a),"Cannot find bound expressions in a no expression token";};b.run=function(a,c,d,j,f,g){for(var e=g.copyDenormalizedBindings(c,f.outCache),i=[],h=0;h<c.length;h++){var m=b.runFilter(a,e[h],g,j,f),m=b.ebv(m);b.isEbvError(m)?d&&(m={__nullify__:!0,bindings:c[h]},i.push(m)):m===!0?i.push(c[h]):d&&(m={__nullify__:!0,bindings:c[h]},
i.push(m))}return i};b.collect=function(a,c,d,j,f){for(var g=f.copyDenormalizedBindings(c,j.outCache),e=[],i=0;i<g.length;i++){var h=b.runFilter(a,g[i],f,d,j);e.push({binding:c[i],value:h})}return e};b.runDistinct=function(){};b.runAggregator=function(a,c,d,j,f){if(c==null||c.length===0)return b.ebvError();else if(a.token==="variable"&&a.kind=="var")return c[0][a.value.value];else if(a.token==="variable"&&a.kind==="aliased")if(a.expression.expressionType==="atomic"&&a.expression.primaryexpression===
"var")return c[0][a.expression.value.value];else if(a.expression.expressionType==="aggregate")if(a.expression.aggregateType==="max"){for(var g=null,e=0;e<c.length;e++){var i=c[e],i=b.runFilter(a.expression.expression,i,d,j,f);b.isEbvError(i)||(g===null?g=i:b.runLtFunction(g,i).value===!0&&(g=i))}return g===null?b.ebvError():g}else if(a.expression.aggregateType==="min"){g=null;for(e=0;e<c.length;e++)i=c[e],i=b.runFilter(a.expression.expression,i,d,j,f),b.isEbvError(i)||(g===null?g=i:b.runGtFunction(g,
i).value===!0&&(g=i));return g===null?b.ebvError():g}else if(a.expression.aggregateType==="count"){var g={},n=0;if(a.expression.expression==="*")if(a.expression.distinct!=null&&a.expression.distinct!="")for(e=0;e<c.length;e++){var i=c[e],m=h.hashTerm(i);g[m]==null&&(g[m]=!0,n++)}else n=c.length;else for(e=0;e<c.length;e++)i=c[e],i=b.runFilter(a.expression.expression,i,d,j,f),b.isEbvError(i)||(a.expression.distinct!=null&&a.expression.distinct!=""?(m=h.hashTerm(i),g[m]==null&&(g[m]=!0,n++)):n++);return{token:"literal",
type:"http://www.w3.org/2001/XMLSchema#integer",value:""+n}}else if(a.expression.aggregateType==="avg"){for(var g={},o={token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:"0"},e=n=0;e<c.length;e++)i=c[e],i=b.runFilter(a.expression.expression,i,d,j,f),b.isEbvError(i)||(a.expression.distinct!=null&&a.expression.distinct!=""?(m=h.hashTerm(i),g[m]==null&&(g[m]=!0,b.isNumeric(i)&&(o=b.runSumFunction(o,i),n++))):b.isNumeric(i)&&(o=b.runSumFunction(o,i),n++));a=b.runDivFunction(o,{token:"literal",
type:"http://www.w3.org/2001/XMLSchema#integer",value:""+n});a.value=""+a.value;return a}else if(a.expression.aggregateType==="sum"){g={};o={token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:"0"};for(e=0;e<c.length;e++)i=c[e],i=b.runFilter(a.expression.expression,i,d,j,f),b.isEbvError(i)||(a.expression.distinct!=null&&a.expression.distinct!=""?(m=h.hashTerm(i),g[m]==null&&(g[m]=!0,b.isNumeric(i)&&(o=b.runSumFunction(o,i)))):b.isNumeric(i)&&(o=b.runSumFunction(o,i)));o.value=""+
o.value;return o}else return i=b.runFilter(aggregate.expression,c[0],j,{blanks:{},outCache:{}})};b.runFilter=function(a,c,d,j,f){if(a.expressionType!=null){var g=a.expressionType;if(g=="relationalexpression"){var g=b.runFilter(a.op1,c,d,j,f),e=b.runFilter(a.op2,c,d,j,f);return b.runRelationalFilter(a,g,e,c,d,j,f)}else if(g=="conditionalor")return b.runOrFunction(a,c,d,j,f);else if(g=="conditionaland")return b.runAndFunction(a,c,d,j,f);else if(g=="additiveexpression")return b.runAddition(a.summand,
a.summands,c,d,j,f);else if(g=="builtincall")return b.runBuiltInCall(a.builtincall,a.args,c,d,j,f);else if(g=="multiplicativeexpression")return b.runMultiplication(a.factor,a.factors,c,d,j,f);else if(g=="unaryexpression")return b.runUnaryExpression(a.unaryexpression,a.expression,c,d,j,f);else if(g=="irireforfunction")return b.runIriRefOrFunction(a.iriref,a.args,c,d,j,f);else if(g=="regex")return b.runRegex(a.text,a.pattern,a.flags,c,d,j,f);else if(g=="atomic")if(a.primaryexpression=="var")return c[a.value.value];
else{if(typeof a.value=="object"&&!(a.value.type==null||typeof a.value.type!="object"))a.value.type=h.lexicalFormBaseUri(a.value.type,f);return a.value}else throw"Unknown filter expression type";}else throw"Cannot find bound expressions in a no expression token";};b.isRDFTerm=function(a){return a==null?!1:a.token&&a.token=="literal"||a.token&&a.token=="uri"||a.token&&a.token=="blank"?!0:!1};b.RDFTermEquality=function(a,c,d,f){return a.token==="literal"&&c.token==="literal"?a.lang==c.lang&&a.type==
c.type&&a.value==c.value?!0:a.type!=null&&c.type!=null?b.ebvError():b.isSimpleLiteral(a)&&c.type!=null?b.ebvError():b.isSimpleLiteral(c)&&a.type!=null?b.ebvError():!1:a.token==="uri"&&c.token==="uri"?h.lexicalFormBaseUri(a,f)==h.lexicalFormBaseUri(c,f):a.token==="blank"&&c.token==="blank"?a.value==c.value:!1};b.isInteger=function(a){return a==null?!1:a.token==="literal"?a.type=="http://www.w3.org/2001/XMLSchema#integer"||a.type=="http://www.w3.org/2001/XMLSchema#decimal"||a.type=="http://www.w3.org/2001/XMLSchema#double"||
a.type=="http://www.w3.org/2001/XMLSchema#nonPositiveInteger"||a.type=="http://www.w3.org/2001/XMLSchema#negativeInteger"||a.type=="http://www.w3.org/2001/XMLSchema#long"||a.type=="http://www.w3.org/2001/XMLSchema#int"||a.type=="http://www.w3.org/2001/XMLSchema#short"||a.type=="http://www.w3.org/2001/XMLSchema#byte"||a.type=="http://www.w3.org/2001/XMLSchema#nonNegativeInteger"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedLong"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedInt"||a.type==
"http://www.w3.org/2001/XMLSchema#unsignedShort"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedByte"||a.type=="http://www.w3.org/2001/XMLSchema#positiveInteger"?!0:!1:!1};b.isFloat=function(a){return a==null?!1:a.token==="literal"?a.type=="http://www.w3.org/2001/XMLSchema#float"?!0:!1:!1};b.isDecimal=function(a){return a==null?!1:a.token==="literal"?a.type=="http://www.w3.org/2001/XMLSchema#decimal"?!0:!1:!1};b.isDouble=function(a){return a==null?!1:a.token==="literal"?a.type=="http://www.w3.org/2001/XMLSchema#double"?
!0:!1:!1};b.isNumeric=function(a){return a==null?!1:a.token==="literal"?a.type=="http://www.w3.org/2001/XMLSchema#integer"||a.type=="http://www.w3.org/2001/XMLSchema#decimal"||a.type=="http://www.w3.org/2001/XMLSchema#float"||a.type=="http://www.w3.org/2001/XMLSchema#double"||a.type=="http://www.w3.org/2001/XMLSchema#nonPositiveInteger"||a.type=="http://www.w3.org/2001/XMLSchema#negativeInteger"||a.type=="http://www.w3.org/2001/XMLSchema#long"||a.type=="http://www.w3.org/2001/XMLSchema#int"||a.type==
"http://www.w3.org/2001/XMLSchema#short"||a.type=="http://www.w3.org/2001/XMLSchema#byte"||a.type=="http://www.w3.org/2001/XMLSchema#nonNegativeInteger"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedLong"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedInt"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedShort"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedByte"||a.type=="http://www.w3.org/2001/XMLSchema#positiveInteger"?!0:!1:!1};b.isSimpleLiteral=function(a){return a&&a.token=="literal"?
a.type==null&&a.lang==null?!0:!1:!1};b.isXsdType=function(a,b){return b&&b.token=="literal"?b.type=="http://www.w3.org/2001/XMLSchema#"+a:!1};b.ebv=function(a){if(a==null||b.isEbvError(a))return b.ebvError();else if(a.token&&a.token==="literal")if(a.type=="http://www.w3.org/2001/XMLSchema#integer"||a.type=="http://www.w3.org/2001/XMLSchema#decimal"||a.type=="http://www.w3.org/2001/XMLSchema#double"||a.type=="http://www.w3.org/2001/XMLSchema#nonPositiveInteger"||a.type=="http://www.w3.org/2001/XMLSchema#negativeInteger"||
a.type=="http://www.w3.org/2001/XMLSchema#long"||a.type=="http://www.w3.org/2001/XMLSchema#int"||a.type=="http://www.w3.org/2001/XMLSchema#short"||a.type=="http://www.w3.org/2001/XMLSchema#byte"||a.type=="http://www.w3.org/2001/XMLSchema#nonNegativeInteger"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedLong"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedInt"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedShort"||a.type=="http://www.w3.org/2001/XMLSchema#unsignedByte"||a.type=="http://www.w3.org/2001/XMLSchema#positiveInteger"){var c=
parseFloat(a.value);return isNaN(c)?!1:parseFloat(a.value)!=0}else return a.type==="http://www.w3.org/2001/XMLSchema#boolean"?a.value==="true"||a.value===!0||a.value==="True":a.type==="http://www.w3.org/2001/XMLSchema#string"?a.value!="":a.type==="http://www.w3.org/2001/XMLSchema#dateTime"?new Date(a.value)!=null:b.isEbvError(a)?a:a.type==null?a.value!=""?!0:!1:b.ebvError();else return a.value===!0};b.ebvTrue=function(){return val={token:"literal",type:"http://www.w3.org/2001/XMLSchema#boolean",value:!0}};
b.ebvFalse=function(){return val={token:"literal",type:"http://www.w3.org/2001/XMLSchema#boolean",value:!1}};b.ebvError=function(){return val={token:"literal",type:"https://github.com/antoniogarrote/js-tools/types#error",value:null}};b.isEbvError=function(a){return typeof a=="object"&&a!=null?a.type==="https://github.com/antoniogarrote/js-tools/types#error":!1};b.ebvBoolean=function(a){return b.isEbvError(a)?a:a===!0?b.ebvTrue():b.ebvFalse()};b.runRelationalFilter=function(a,c,d,f,h,g,e){a=a.operator;
if(a==="=")return b.runEqualityFunction(c,d,f,h,g,e);else if(a==="!="){c=b.runEqualityFunction(c,d,f,h,g,e);if(!b.isEbvError(c))c.value=!c.value;return c}else if(a==="<")return b.runLtFunction(c,d,f);else if(a===">")return b.runGtFunction(c,d,f);else if(a==="<=")return b.runLtEqFunction(c,d,f);else if(a===">=")return b.runGtEqFunction(c,d,f);else throw"Error applying relational filter, unknown operator";};b.effectiveTypeValue=function(a){if(a.token=="literal")if(a.type=="http://www.w3.org/2001/XMLSchema#integer")return a=
parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#decimal")return a=parseFloat(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#float")return a=parseFloat(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#double")return a=parseFloat(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#nonPositiveInteger")return a=parseFloat(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#negativeInteger")return a=parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#long")return a=
parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#int")return a=parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#short")return a=parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#byte")return a=parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#nonNegativeInteger")return a=parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#unsignedLong")return a=parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#unsignedInt")return a=
parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#unsignedShort")return a=parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#unsignedByte")return a=parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#positiveInteger")return a=parseInt(a.value);else if(a.type=="http://www.w3.org/2001/XMLSchema#date"||a.type=="http://www.w3.org/2001/XMLSchema#dateTime")try{return h.parseISO8601(a.value)}catch(b){return null}else return a.type=="http://www.w3.org/2001/XMLSchema#boolean"?
a.value===!0||a.value==="true"||a.value==="1"||a.value===1||a.value===!0?!0:a.value===!1||a.value==="false"||a.value==="0"||a.value===0||a.value===!1?!1:void 0:a.type=="http://www.w3.org/2001/XMLSchema#string"?a.value===null||a.value===void 0?void 0:""+a.value:a.value;else throw console.log("not implemented yet"),"value not supported in operations yet";};b.runOrFunction=function(a,c,d,f,h){for(var g=null,e=0;e<a.operands.length;e++){var i=b.runFilter(a.operands[e],c,d,f,h);b.isEbvError(i)==!1&&(i=
b.ebv(i));g==null?g=i:b.isEbvError(i)?g=b.isEbvError(g)?b.ebvError():g===!0?!0:b.ebvError():i===!0?g=!0:b.isEbvError(g)&&(g=b.ebvError())}return b.ebvBoolean(g)};b.runAndFunction=function(a,c,d,f,h){for(var g=null,e=0;e<a.operands.length;e++){var i=b.runFilter(a.operands[e],c,d,f,h);b.isEbvError(i)==!1&&(i=b.ebv(i));g==null?g=i:b.isEbvError(i)?g=b.isEbvError(g)?b.ebvError():g===!0?b.ebvError():!1:i===!0?b.isEbvError(g)&&(g=b.ebvError()):g=!1}return b.ebvBoolean(g)};b.runEqualityFunction=function(a,
c,d,f,k,g){if(b.isEbvError(a)||b.isEbvError(c))return b.ebvError();if(b.isNumeric(a)&&b.isNumeric(c))return d=b.effectiveTypeValue(a),k=b.effectiveTypeValue(c),isNaN(d)||isNaN(k)?b.ebvBoolean(b.RDFTermEquality(a,c,f,g)):b.ebvBoolean(d==k);else if((b.isSimpleLiteral(a)||b.isXsdType("string",a))&&(b.isSimpleLiteral(c)||b.isXsdType("string",c)))return b.ebvBoolean(b.effectiveTypeValue(a)==b.effectiveTypeValue(c));else if(b.isXsdType("boolean",a)&&b.isXsdType("boolean",c))return b.ebvBoolean(b.effectiveTypeValue(a)==
b.effectiveTypeValue(c));else if((b.isXsdType("dateTime",a)||b.isXsdType("date",a))&&(b.isXsdType("dateTime",c)||b.isXsdType("date",c))){if(b.isXsdType("dateTime",a)&&b.isXsdType("date",c))return b.ebvFalse();if(b.isXsdType("date",a)&&b.isXsdType("dateTime",c))return b.ebvFalse();a=h.compareDateComponents(a.value,c.value);return a!=null?a==0?b.ebvTrue():b.ebvFalse():b.ebvError()}else return b.isRDFTerm(a)&&b.isRDFTerm(c)?b.ebvBoolean(b.RDFTermEquality(a,c,f,g)):b.ebvFalse()};b.runGtFunction=function(a,
c){if(b.isEbvError(a)||b.isEbvError(c))return b.ebvError();if(b.isNumeric(a)&&b.isNumeric(c))return b.ebvBoolean(b.effectiveTypeValue(a)>b.effectiveTypeValue(c));else if(b.isSimpleLiteral(a)&&b.isSimpleLiteral(c))return b.ebvBoolean(b.effectiveTypeValue(a)>b.effectiveTypeValue(c));else if(b.isXsdType("string",a)&&b.isXsdType("string",c))return b.ebvBoolean(b.effectiveTypeValue(a)>b.effectiveTypeValue(c));else if(b.isXsdType("boolean",a)&&b.isXsdType("boolean",c))return b.ebvBoolean(b.effectiveTypeValue(a)>
b.effectiveTypeValue(c));else if((b.isXsdType("dateTime",a)||b.isXsdType("date",a))&&(b.isXsdType("dateTime",c)||b.isXsdType("date",c))){if(b.isXsdType("dateTime",a)&&b.isXsdType("date",c))return b.ebvFalse();if(b.isXsdType("date",a)&&b.isXsdType("dateTime",c))return b.ebvFalse();var d=h.compareDateComponents(a.value,c.value);return d!=null?d==1?b.ebvTrue():b.ebvFalse():b.ebvError()}else return b.ebvFalse()};b.runTotalGtFunction=function(a,c){return b.isEbvError(a)||b.isEbvError(c)?b.ebvError():b.isNumeric(a)&&
b.isNumeric(c)||b.isSimpleLiteral(a)&&b.isSimpleLiteral(c)||b.isXsdType("string",a)&&b.isSimpleLiteral("string",c)||b.isXsdType("boolean",a)&&b.isSimpleLiteral("boolean",c)||b.isXsdType("dateTime",a)&&b.isSimpleLiteral("dateTime",c)?b.runGtFunction(a,c,[]):a.token&&a.token==="uri"&&c.token&&c.token==="uri"?b.ebvBoolean(a.value>c.value):a.token&&a.token==="literal"&&c.token&&c.token==="literal"?b.ebvBoolean(""+a.value+a.type+a.lang>""+c.value+c.type+c.lang):a.token&&a.token==="blank"&&c.token&&c.token===
"blank"?b.ebvBoolean(a.value>c.value):a.value&&c.value?b.ebvBoolean(a.value>c.value):b.ebvTrue()};b.runLtFunction=function(a,c){if(b.isEbvError(a)||b.isEbvError(c))return b.ebvError();if(b.isNumeric(a)&&b.isNumeric(c))return b.ebvBoolean(b.effectiveTypeValue(a)<b.effectiveTypeValue(c));else if(b.isSimpleLiteral(a)&&b.isSimpleLiteral(c))return b.ebvBoolean(b.effectiveTypeValue(a)<b.effectiveTypeValue(c));else if(b.isXsdType("string",a)&&b.isXsdType("string",c))return b.ebvBoolean(b.effectiveTypeValue(a)<
b.effectiveTypeValue(c));else if(b.isXsdType("boolean",a)&&b.isXsdType("boolean",c))return b.ebvBoolean(b.effectiveTypeValue(a)<b.effectiveTypeValue(c));else if((b.isXsdType("dateTime",a)||b.isXsdType("date",a))&&(b.isXsdType("dateTime",c)||b.isXsdType("date",c))){if(b.isXsdType("dateTime",a)&&b.isXsdType("date",c))return b.ebvFalse();if(b.isXsdType("date",a)&&b.isXsdType("dateTime",c))return b.ebvFalse();var d=h.compareDateComponents(a.value,c.value);return d!=null?d==-1?b.ebvTrue():b.ebvFalse():
b.ebvError()}else return b.ebvFalse()};b.runGtEqFunction=function(a,c){if(b.isEbvError(a)||b.isEbvError(c))return b.ebvError();if(b.isNumeric(a)&&b.isNumeric(c))return b.ebvBoolean(b.effectiveTypeValue(a)>=b.effectiveTypeValue(c));else if(b.isSimpleLiteral(a)&&b.isSimpleLiteral(c))return b.ebvBoolean(b.effectiveTypeValue(a)>=b.effectiveTypeValue(c));else if(b.isXsdType("string",a)&&b.isXsdType("string",c))return b.ebvBoolean(b.effectiveTypeValue(a)>=b.effectiveTypeValue(c));else if(b.isXsdType("boolean",
a)&&b.isXsdType("boolean",c))return b.ebvBoolean(b.effectiveTypeValue(a)>=b.effectiveTypeValue(c));else if((b.isXsdType("dateTime",a)||b.isXsdType("date",a))&&(b.isXsdType("dateTime",c)||b.isXsdType("date",c))){if(b.isXsdType("dateTime",a)&&b.isXsdType("date",c))return b.ebvFalse();if(b.isXsdType("date",a)&&b.isXsdType("dateTime",c))return b.ebvFalse();var d=h.compareDateComponents(a.value,c.value);return d!=null?d!=-1?b.ebvTrue():b.ebvFalse():b.ebvError()}else return b.ebvFalse()};b.runLtEqFunction=
function(a,c){if(b.isEbvError(a)||b.isEbvError(c))return b.ebvError();if(b.isNumeric(a)&&b.isNumeric(c))return b.ebvBoolean(b.effectiveTypeValue(a)<=b.effectiveTypeValue(c));else if(b.isSimpleLiteral(a)&&b.isSimpleLiteral(c))return b.ebvBoolean(b.effectiveTypeValue(a)<=b.effectiveTypeValue(c));else if(b.isXsdType("string",a)&&b.isXsdType("string",c))return b.ebvBoolean(b.effectiveTypeValue(a)<=b.effectiveTypeValue(c));else if(b.isXsdType("boolean",a)&&b.isXsdType("boolean",c))return b.ebvBoolean(b.effectiveTypeValue(a)<=
b.effectiveTypeValue(c));else if((b.isXsdType("dateTime",a)||b.isXsdType("date",a))&&(b.isXsdType("dateTime",c)||b.isXsdType("date",c))){if(b.isXsdType("dateTime",a)&&b.isXsdType("date",c))return b.ebvFalse();if(b.isXsdType("date",a)&&b.isXsdType("dateTime",c))return b.ebvFalse();var d=h.compareDateComponents(a.value,c.value);return d!=null?d!=1?b.ebvTrue():b.ebvFalse():b.ebvError()}else return b.ebvFalse()};b.runAddition=function(a,c,d,f,h,g){var e=b.runFilter(a,d,f,h,g);if(b.isEbvError(e))return b.ebvError();
a=e;if(b.isNumeric(e)){for(e=0;e<c.length;e++){var i=b.runFilter(c[e].expression,d,f,h,g);if(b.isNumeric(i))c[e].operator==="+"?a=b.runSumFunction(a,i):c[e].operator==="-"&&(a=b.runSubFunction(a,i));else return b.ebvFalse()}return a}else return b.ebvFalse()};b.runSumFunction=function(a,c){if(b.isEbvError(a)||b.isEbvError(c))return b.ebvError();var d=b.effectiveTypeValue(a)+b.effectiveTypeValue(c);return b.isDouble(a)||b.isDouble(c)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#double",value:d}:
b.isFloat(a)||b.isFloat(c)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#float",value:d}:b.isDecimal(a)||b.isDecimal(c)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#decimal",value:d}:{token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:d}};b.runSubFunction=function(a,c){if(b.isEbvError(a)||b.isEbvError(c))return b.ebvError();var d=b.effectiveTypeValue(a)-b.effectiveTypeValue(c);return b.isDouble(a)||b.isDouble(c)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#double",
value:d}:b.isFloat(a)||b.isFloat(c)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#float",value:d}:b.isDecimal(a)||b.isDecimal(c)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#decimal",value:d}:{token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:d}};b.runMultiplication=function(a,c,d,f,h,g){a=b.runFilter(a,d,f,h,g);if(b.isEbvError(a))return a;var e=a;if(b.isNumeric(a)){for(var i=0;i<c.length;i++){var n=b.runFilter(c[i].expression,d,f,h,g);if(b.isEbvError(n))return a;
if(b.isNumeric(n))c[i].operator==="*"?e=b.runMulFunction(e,n):c[i].operator==="/"&&(e=b.runDivFunction(e,n));else return b.ebvFalse()}return e}else return b.ebvFalse()};b.runMulFunction=function(a,c){if(b.isEbvError(a)||b.isEbvError(c))return b.ebvError();var d=b.effectiveTypeValue(a)*b.effectiveTypeValue(c);return b.isDouble(a)||b.isDouble(c)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#double",value:d}:b.isFloat(a)||b.isFloat(c)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#float",
value:d}:b.isDecimal(a)||b.isDecimal(c)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#decimal",value:d}:{token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:d}};b.runDivFunction=function(a,c){if(b.isEbvError(a)||b.isEbvError(c))return b.ebvError();var d=b.effectiveTypeValue(a)/b.effectiveTypeValue(c);return b.isDouble(a)||b.isDouble(c)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#double",value:d}:b.isFloat(a)||b.isFloat(c)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#float",
value:d}:b.isDecimal(a)||b.isDecimal(c)?{token:"literal",type:"http://www.w3.org/2001/XMLSchema#decimal",value:d}:{token:"literal",type:"http://www.w3.org/2001/XMLSchema#integer",value:d}};b.runBuiltInCall=function(a,c,d,f,h,g){if(a==="notexists"||a==="exists"){var e=JSON.parse(JSON.stringify(c[0])),e=f.abstractQueryTree.parseSelect({pattern:e},d),e=f.abstractQueryTree.bind(e.pattern,d),d=f.executeSelectUnit([{kind:"*"}],h,e,g);return a==="exists"?b.ebvBoolean(d.length!==0):b.ebvBoolean(d.length===
0)}else{for(var e=[],i=0;i<c.length;i++)if(c[i].token==="var")e.push(c[i]);else{var n=b.runFilter(c[i],d,f,h,g);if(b.isEbvError(n))return n;e.push(n)}if(a==="str")return e[0].token==="literal"?{token:"literal",type:null,value:""+e[0].value}:e[0].token==="uri"?{token:"literal",type:null,value:e[0].value}:b.ebvFalse();else if(a==="lang")return e[0].token==="literal"?e[0].lang!=null?{token:"literal",value:""+e[0].lang}:{token:"literal",value:""}:b.ebvError();else if(a==="datatype")return e[0].token===
"literal"?(a=e[0],a.type!=null?typeof a.type==="string"?{token:"uri",value:a.type,prefix:null,suffix:null}:a.type:a.lang==null?{token:"uri",value:"http://www.w3.org/2001/XMLSchema#string",prefix:null,suffix:null}:b.ebvError()):b.ebvError();else if(a==="isliteral")return e[0].token==="literal"?b.ebvTrue():b.ebvFalse();else if(a==="isblank")return e[0].token==="blank"?b.ebvTrue():b.ebvFalse();else if(a==="isuri"||a==="isiri")return e[0].token==="uri"?b.ebvTrue():b.ebvFalse();else if(a==="sameterm")return a=
b.RDFTermEquality(e[0],e[1],f,g),b.isEbvError(a)&&(a=!1),b.ebvBoolean(a);else if(a==="langmatches")return a=e[0],d=e[1],a.token==="literal"&&d.token==="literal"?d.value==="*"&&a.value!=""?b.ebvTrue():b.ebvBoolean(a.value.toLowerCase().indexOf(d.value.toLowerCase())===0):b.ebvError();else if(a==="bound")return a=e[0].value,a==null?b.ebvError():d[a]!=null?b.ebvTrue():b.ebvFalse();else throw"Builtin call "+a+" not implemented yet";}};b.runUnaryExpression=function(a,c,d,f,h,g){c=b.runFilter(c,d,f,h,g);
if(b.isEbvError(c))return c;if(a==="!"){var e=b.ebv(c);return b.isEbvError(e)?b.ebvFalse():b.ebvBoolean(!e)}else if(a==="+")return b.isNumeric(c)?c:b.ebvError();else if(a==="-")if(b.isNumeric(c)){a={};for(e in c)a[e]=c[e];a.value=-a.value;return a}else return b.ebvError()};b.runRegex=function(a,c,d,f,h,g,e){if(a!=null)a=b.runFilter(a,f,h,g,e);else return b.ebvError();if(c!=null)c=b.runFilter(c,f,h,g,e);else return b.ebvError();d!=null&&(d=b.runFilter(d,f,h,g,e));if(c!=null&&c.token==="literal"&&(d==
null||d.token==="literal"))c=c.value,d=d==null?null:d.value;else return b.ebvError();if(a!=null&&a.token=="var")if(f[a.value]!=null)a=f[a.value];else return b.ebvError();else if(a!=null&&a.token==="literal")if(a.type==null||b.isXsdType("string",a))a=a.value;else return b.ebvError();else return b.ebvError();return(d==null?RegExp(c):RegExp(c,d.toLowerCase())).exec(a)?b.ebvTrue():b.ebvFalse()};b.normalizeLiteralDatatype=function(a,b,d){if(!(a.value.type==null||typeof a.value.type!="object"))a.value.type=
h.lexicalFormBaseUri(a.value.type,d);return a};b.runIriRefOrFunction=function(a,c,d,f,k,g){if(c==null)return a;else{for(var e=[],i=0;i<c.length;i++)e.push(b.runFilter(c[i],d,f,k,g));a=h.lexicalFormBaseUri(a,g);if(a=="http://www.w3.org/2001/XMLSchema#integer"||a=="http://www.w3.org/2001/XMLSchema#decimal"||a=="http://www.w3.org/2001/XMLSchema#double"||a=="http://www.w3.org/2001/XMLSchema#nonPositiveInteger"||a=="http://www.w3.org/2001/XMLSchema#negativeInteger"||a=="http://www.w3.org/2001/XMLSchema#long"||
a=="http://www.w3.org/2001/XMLSchema#int"||a=="http://www.w3.org/2001/XMLSchema#short"||a=="http://www.w3.org/2001/XMLSchema#byte"||a=="http://www.w3.org/2001/XMLSchema#nonNegativeInteger"||a=="http://www.w3.org/2001/XMLSchema#unsignedLong"||a=="http://www.w3.org/2001/XMLSchema#unsignedInt"||a=="http://www.w3.org/2001/XMLSchema#unsignedShort"||a=="http://www.w3.org/2001/XMLSchema#unsignedByte"||a=="http://www.w3.org/2001/XMLSchema#positiveInteger")if(e=e[0],e.token==="literal")if(e=b.normalizeLiteralDatatype(e,
f,g),e.type=="http://www.w3.org/2001/XMLSchema#integer"||e.type=="http://www.w3.org/2001/XMLSchema#decimal"||e.type=="http://www.w3.org/2001/XMLSchema#double"||e.type=="http://www.w3.org/2001/XMLSchema#nonPositiveInteger"||e.type=="http://www.w3.org/2001/XMLSchema#negativeInteger"||e.type=="http://www.w3.org/2001/XMLSchema#long"||e.type=="http://www.w3.org/2001/XMLSchema#int"||e.type=="http://www.w3.org/2001/XMLSchema#short"||e.type=="http://www.w3.org/2001/XMLSchema#byte"||e.type=="http://www.w3.org/2001/XMLSchema#nonNegativeInteger"||
e.type=="http://www.w3.org/2001/XMLSchema#unsignedLong"||e.type=="http://www.w3.org/2001/XMLSchema#unsignedInt"||e.type=="http://www.w3.org/2001/XMLSchema#unsignedShort"||e.type=="http://www.w3.org/2001/XMLSchema#unsignedByte"||e.type=="http://www.w3.org/2001/XMLSchema#positiveInteger")return e.type=a,e;else if(e.type=="http://www.w3.org/2001/XMLSchema#boolean")return b.ebv(e)==!0?(e.type=a,e.value=1):(e.type=a,e.value=0),e;else if(e.type=="http://www.w3.org/2001/XMLSchema#float"||e.type=="http://www.w3.org/2001/XMLSchema#double")return e.type=
a,e.value=parseInt(e.value),e;else if(e.type=="http://www.w3.org/2001/XMLSchema#string"||e.type==null){if(e.value.split(".").length>2)return b.ebvError();else if(e.value.split("-").length>2)return b.ebvError();else if(e.value.split("/").length>2)return b.ebvError();else if(e.value.split("+").length>2)return b.ebvError();if(a=="http://www.w3.org/2001/XMLSchema#decimal"&&(e.value.indexOf("e")!=-1||e.value.indexOf("E")!=-1))return b.ebvError();if(a=="http://www.w3.org/2001/XMLSchema#int"||a=="http://www.w3.org/2001/XMLSchema#integer")if(e.value.indexOf("e")!=
-1||e.value.indexOf("E")!=-1||e.value.indexOf(".")!=-1)return b.ebvError();try{return e.value=parseInt(parseFloat(e.value)),isNaN(e.value)?b.ebvError():(e.type=a,e)}catch(n){return b.ebvError()}}else return b.ebvError();else return b.ebvError();else if(a=="http://www.w3.org/2001/XMLSchema#boolean")return e=e[0],e.token==="literal"&&e.type==null?e.value==="true"||e.value==="1"?b.ebvTrue():e.value==="false"||e.value==="0"?b.ebvFalse():b.ebvError():e.token==="literal"?b.isEbvError(e)?e:b.ebvBoolean(e):
b.ebvError();else if(a=="http://www.w3.org/2001/XMLSchema#string")if(e=e[0],e.token==="literal")if(e=b.normalizeLiteralDatatype(e,f,g),e.type=="http://www.w3.org/2001/XMLSchema#integer"||e.type=="http://www.w3.org/2001/XMLSchema#decimal"||e.type=="http://www.w3.org/2001/XMLSchema#double"||e.type=="http://www.w3.org/2001/XMLSchema#nonPositiveInteger"||e.type=="http://www.w3.org/2001/XMLSchema#negativeInteger"||e.type=="http://www.w3.org/2001/XMLSchema#long"||e.type=="http://www.w3.org/2001/XMLSchema#int"||
e.type=="http://www.w3.org/2001/XMLSchema#short"||e.type=="http://www.w3.org/2001/XMLSchema#byte"||e.type=="http://www.w3.org/2001/XMLSchema#nonNegativeInteger"||e.type=="http://www.w3.org/2001/XMLSchema#unsignedLong"||e.type=="http://www.w3.org/2001/XMLSchema#unsignedInt"||e.type=="http://www.w3.org/2001/XMLSchema#unsignedShort"||e.type=="http://www.w3.org/2001/XMLSchema#unsignedByte"||e.type=="http://www.w3.org/2001/XMLSchema#positiveInteger"||e.type=="http://www.w3.org/2001/XMLSchema#float")return e.type=
a,e.value=""+e.value,e;else if(e.type=="http://www.w3.org/2001/XMLSchema#string")return e;else if(e.type=="http://www.w3.org/2001/XMLSchema#boolean")return b.ebv(e)?(e.type=a,e.value="true"):(e.type=a,e.value="false"),e;else if(e.type=="http://www.w3.org/2001/XMLSchema#dateTime"||e.type=="http://www.w3.org/2001/XMLSchema#date"){e.type=a;if(typeof e.value!="string")e.value=h.iso8601(e.value);return e}else return e.type==null?(e.value=""+e.value,e.type=a,e):b.ebvError();else return e.token==="uri"?
{token:"literal",value:h.lexicalFormBaseUri(e,g),type:a,lang:null}:b.ebvError();else if(a=="http://www.w3.org/2001/XMLSchema#dateTime"||a=="http://www.w3.org/2001/XMLSchema#date")if(e=e[0],e.type=="http://www.w3.org/2001/XMLSchema#dateTime"||e.type=="http://www.w3.org/2001/XMLSchema#date")return e;else if(e.type=="http://www.w3.org/2001/XMLSchema#string"||e.type==null)try{return e.value=h.iso8601(h.parseStrictISO8601(e.value)),e.type=a,e}catch(m){return b.ebvError()}else return b.ebvError();else if(a==
"http://www.w3.org/2001/XMLSchema#float")if(e=e[0],e.token==="literal")if(e=b.normalizeLiteralDatatype(e,f,g),e.type=="http://www.w3.org/2001/XMLSchema#decimal"||e.type=="http://www.w3.org/2001/XMLSchema#int")return e.type=a,e.value=parseFloat(e.value),e;else if(e.type=="http://www.w3.org/2001/XMLSchema#boolean")return b.ebv(e)==!0?(e.type=a,e.value=1):(e.type=a,e.value=0),e;else if(e.type=="http://www.w3.org/2001/XMLSchema#float"||e.type=="http://www.w3.org/2001/XMLSchema#double")return e.type=a,
e.value=parseFloat(e.value),e;else if(e.type=="http://www.w3.org/2001/XMLSchema#string")try{return e.value=parseFloat(e.value),isNaN(e.value)?b.ebvError():(e.type=a,e)}catch(o){return b.ebvError()}else if(e.type==null){if(e.value.split(".").length>2)return b.ebvError();else if(e.value.split("-").length>2)return b.ebvError();else if(e.value.split("/").length>2)return b.ebvError();else if(e.value.split("+").length>2)return b.ebvError();try{return e.value=parseFloat(e.value),isNaN(e.value)?b.ebvError():
(e.type=a,e)}catch(q){return b.ebvError()}}else return b.ebvError();else return b.ebvError();else return b.ebvError()}};try{typeof module==="undefined"?window.RDFJSInterface=f:module.exports=f}catch(q){}})();
